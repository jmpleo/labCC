# –®–∏—Ñ—Ä –ö–æ–ª–æ–Ω–Ω–æ–π –ó–∞–º–µ–Ω—ã

<img src="./scheme.png"/>

–í –¥–∞–Ω–Ω–æ–π —Å—Ö–µ–º–µ —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è 2 –∫–ª—é—á–∞ –¥–ª–∏–Ω—ã 24 –∏ 32 –±–∏—Ç–∞. –û–Ω–∏ —è–≤–ª—è—é—Ç—Å—è –Ω–∞—á–∞–ª—å–Ω—ã–º –∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ–º –õ–†–°-1 –∏ –õ–†–°-2 —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ. –ö–∞–∂–¥—ã–π –±–∞–π—Ç –æ—Ç–∫—Ä—ã—Ç–æ–≥–æ —Ç–µ–∫—Å—Ç–∞ –ø–æ–º–µ—â–∞–µ—Ç—Å—è –≤ –Ω–µ–∞–≤—Ç–æ–Ω–æ–º–Ω—ã–π —Ä–µ–≥–∏—Å—Ç—Ä —Å–¥–≤–∏–≥–∞, –ø–æ—Å–ª–µ —á–µ–≥–æ —Å–æ–≤–µ—Ä—à–∞–µ—Ç—Å—è 10 —Ç–∞–∫—Ç–æ–≤. 

–í –∫–∞–∂–¥–æ–º —Ç–∞–∫—Ç–µ –≤—ã—á–∏—Å–ª—è–µ—Ç—Å—è:
1. –∑–Ω–∞—á–µ–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ –æ–±—Ä–∞—Ç–Ω–æ–π —Å–≤—è–∑–∏ $\phi$ –∏ —Å–∫–ª–∞–¥—ã–≤–∞–µ—Ç—Å—è —Å –æ—á–µ—Ä–µ–¥–Ω—ã–º –±–∏—Ç–æ–º –∫–ª—é—á–µ–≤–æ–≥–æ –ø–æ—Ç–æ–∫–∞, –∫–æ—Ç–æ—Ä—ã–π –ø–æ–ª—É—á–∞–µ—Ç—Å—è –Ω–∞ –≤—ã—Ö–æ–¥–µ —Ñ—É–Ω–∫—Ü–∏–∏ F.
2. –†–µ–∑—É–ª—å—Ç–∞—Ç –ø–æ–º–µ—â–∞–µ—Ç—Å—è —Å–æ —Å–¥–≤–∏–≥–æ–º –≤ –Ω–µ–∞–≤—Ç–æ–Ω–æ–º–Ω—ã–π —Ä–µ–≥–∏—Å—Ç—Ä.

–ü–æ–ª—É—á–µ–Ω–Ω–∞—è –ø–æ—Å–ª–µ 10 —Ç–∞–∫–∏—Ö —Ç–∞–∫—Ç–æ–≤ –±–∞–π—Ç –≤ —Ä–µ–≥–∏—Å—Ç—Ä–µ —è–≤–ª—è–µ—Ç—Å—è –±–∞–π—Ç–æ–º —à–∏—Ñ—Ä—Ç–µ–∫—Å—Ç–∞. –®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç—Å—è (–õ–†–° –ø—Ä–∏ —ç—Ç–æ–º –Ω–µ —Å–±—Ä–∞—Å—ã–≤–∞—é—Ç—Å—è), –ø–æ–∫–∞ –≤ –æ—Ç–∫—Ä—ã—Ç–æ–º —Ç–µ–∫—Å—Ç–µ –Ω–µ –∫–æ–Ω—á–∞—Ç—Å—è –±—É–∫–≤—ã.

–í –¥–∞–Ω–Ω–æ–π —Ä–∞–±–æ—Ç–µ –ø—Ä–µ–¥–ª–∞–≥–∞–µ—Ç—Å—è –≤—Å–∫—Ä—ã—Ç—å —à–∏—Ñ—Ä –ø–æ –ø–∞—Ä–µ –æ—Ç–∫—Ä—ã—Ç–æ–≥–æ –∏ —à–∏—Ñ—Ä —Ç–µ–∫—Å—Ç–∞, –∏—Å–ø–æ–ª—å–∑—É—è –∫—Ä–∏–ø—Ç–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫—É—é ¬´—Å–ª–∞–±–æ—Å—Ç—å¬ª —Å—Ö–µ–º—ã: –º–∞–ª–∞—è –¥–ª–∏–Ω–∞ —É–ø—Ä–∞–≤–ª—è—é—â–µ–π –∫–æ–º–±–∏–Ω–∞—Ü–∏–∏. 

–†–∞—Å—Å–º–∞—Ç—Ä–∏–≤–∞—è –ø–∞—Ä—É –±–∞—Ç–æ–≤ –æ—Ç–∫—Ä—ã—Ç–æ–≥–æ –∏ —à–∏—Ñ—Ä—Ç–µ–∫—Å—Ç–∞, —Ç—Ä–µ–±—É–µ—Ç—Å—è –Ω–∞–π—Ç–∏ –≤—Å–µ –ø–æ–¥—Å—Ç–∞–Ω–æ–≤–∫–∏, –ø–µ—Ä–µ–≤–æ–¥—è—â–∏–µ –±–∞–π—Ç—ã –æ—Ç–∫—Ä—ã—Ç–æ–≥–æ —Ç–µ–∫—Å—Ç–∞ –≤ –±–∞–π—Ç —à–∏—Ñ—Ä—Ç–µ–∫—Å—Ç–∞. –ö–∞–∂–¥–∞—è –∏–∑ –ø–æ–¥—Å—Ç–∞–Ω–æ–≤–æ–∫ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è 10 –±–∏—Ç–∞–º–∏ –∫–ª—é—á–µ–≤–æ–≥–æ –ø–æ—Ç–æ–∫–∞. –ü–æ–ª—É—á–∞—è –Ω–∞ –∫–∞–∂–¥—É—é –ø–∞—Ä—É –±—É–∫–≤ –æ—Ç–∫—Ä—ã—Ç–æ–≥–æ –∏ —à–∏—Ñ—Ä—Ç–µ–∫—Å—Ç–∞ —Å–ø–∏—Å–æ–∫ –≤–æ–∑–º–æ–∂–Ω—ã—Ö –æ—Ç—Ä–µ–∑–∫–æ–≤ –∫–ª—é—á–µ–≤–æ–≥–æ –ø–æ—Ç–æ–∫–∞, –Ω—É–∂–Ω–æ –ø–µ—Ä–µ–±—Ä–∞—Ç—å –≤–∞—Ä–∏–∞–Ω—Ç—ã –≥–∞–º–º—ã –∏—Å–ø–æ–ª—å–∑—É—è –∫—Ä–∏—Ç–µ—Ä–∏–π –Ω–∞ –æ—Ç–∫—Ä—ã—Ç—ã–π —Ç–µ–∫—Å—Ç.

## 1. –†–µ–∞–ª–∏–∑—É–µ–º —à–∏—Ñ—Ä

–†–µ–∞–ª–∏–∑—É–µ–º –≤—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —à–∏—Ä—Ñ–∞, –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–∏ —Å–æ —Å—Ö–µ–º–æ–π —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è

### 1.1. –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —É–ø—Ä–∞–≤–ª—è—é—â–µ–≥–æ –±–ª–æ–∫–∞

–í –ø–µ—Ä–≤—É—é –æ—á–µ—Ä–µ–¥—å –æ–ø—Ä–µ–¥–µ–ª–∏–º —Ñ—É–Ω–∫—Ü–∏—é $\phi(x_7,...x_0)=x_0\oplus x_2x_3x_7$.
–ü—Ä–∏ —ç—Ç–æ–º —Å—á–∏—Ç–∞–µ–º, —á—Ç–æ $x=x_7...x_0$ - –±–∏—Ç–æ–≤–æ–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –æ—á–µ—Ä–µ–¥–Ω–æ–≥–æ –±–∞–π—Ç–∞, –∞ —Ä–µ–∑—É–ª—å—Ç—Ä—É—é—â–∏–π –±–∏—Ç —Ñ—É–Ω–∫—Ü–∏–∏ —Ö—Ä–∞–Ω–∏–º –≤ –º–ª–∞–¥—à–µ–º –±–∏—Ç–µ –≤—ã—Ö–æ–¥–Ω–æ–≥–æ –±–∞–π—Ç–∞


```python
def phi(x):
    return ( 
        (x) ^ ((x>>2)&(x>>3)&(x>>7)) 
    ) & 1
```

–î–∞–ª–µ–µ –æ–ø—Ä–µ–¥–µ–ª–∏–º —Ñ—É–Ω–∫—Ü–∏—é –æ–¥–Ω–æ–≥–æ —Ç–∞–∫—Ç–∞ $g$ –∫–æ—Ç–æ—Ä–∞—è –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –±–∞–π—Ç–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è $x=(x_7,....,x_0)$ –∏ –±–∏—Ç–∞ –∫–ª—é—á–µ–≤–æ–≥–æ –ø–æ—Ç–æ–∫–∞ $\gamma_i$

–ü—Ä–∏—á–µ–º $g_{\gamma_i}(x) = (\gamma_i \oplus \phi(x), x_7,...,x_1)=(\gamma_i \oplus x_0 \oplus x_2x_3x_7, x_7, ...,x_1)$


```python
def g(gamma, x):
    
    return (
        ((x>>1) &0x7F) 
        ^ 
        ((phi(x) ^ (gamma &1)) << 7)
    )
```

–û–±—Ä–∞—Ç–Ω–æ–µ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –¥–ª—è $g$ –º–æ–∂–Ω–æ –≤—ã—á–∏—Å–ª–∏—Ç—å –∫–∞–∫ —Å–¥–∏–≤–≥ –≤–ª–µ–≤–æ:

$g^{-1}_{\gamma_i}(y) = (y_6,...,y_0,\phi(y_6,...,y_0,y_7)\oplus\gamma_i)$

–î–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ, 

$g_{\gamma_i}(g_{\gamma_i}^{-1}(y)) =g_{\gamma_i}(y_6,...,y_0,\phi(y_6,...,y_0,y_7)\oplus\gamma_i)=$

$=(\gamma_i \oplus \phi(y_6,...,y_0,\phi(y_6,...,y_0,y_7) \oplus \gamma_i,y_6,...y_0)=$

$=(y_6y_2y_1 \oplus \phi(y_6,...,y_0,y_7),y_6,...,y_0)=$

$=(y_6y_2y_1 \oplus y_6y_2y_1 \oplus y_7,y_6,...,y_0)=(y_7,y_6,...,y_0)=y$


```python
def inv_g(gamma, y):
    return (
        ((y<<1) &0xFE)
        ^ 
        phi(
            ((y<<1) &0xFF)
            ^ 
            ((y>>7) &1)
        )
        ^
        (gamma &1)
    )
```

### 1.2. –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä –∫–ª—é—á–µ–≤–æ–≥–æ –ø–æ—Ç–æ–∫–∞

–¢–µ–ø–µ—Ä—å –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å —Ä–µ–≥–∏—Å—Ç—Ä—ã, —Ä–µ–∞–ª–∏–∑—É–µ–º—ã–µ —à–∏—Ñ—Ä–æ–º –≤ –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä–µ –∫–ª—é—á–µ–≤–æ–≥–æ –ø–æ—Ç–æ–∫–∞

–î–ª—è —ç—Ç–æ–≥–æ —Å–æ–∑–¥–∞–¥–∏–º –∫–ª–∞—Å—Å, –∫–æ—Ç–æ—Ä—ã–π –±—É–¥–µ—Ç –ø—Ä–∏–Ω–∏–º–∞—Ç—å –¥–ª–∏–Ω—É —Å–æ—Å—Ç–æ—è–Ω–∏—è –≤ –±–∏—Ç–∞—Ö, —Ñ—É–Ω–∫—Ü–∏—é –æ–±—Ä–∞—Ç–Ω–æ–π —Å–≤—è–∑–∏ –∏ –Ω–∞—á–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ


```python
class R:
    def __init__(self, stateLen, feedBack, initState):
        self.s = initState
        self.l = stateLen
        self.f = feedBack
    
    # –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ –º–ª–∞–¥—à–µ–≥–æ –±–∏—Ç–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è
    # —Å –ø–æ—Å–ª–µ–¥—É—é—â–º —Å–¥–∏–≤–≥–æ–º –≤–ø—Ä–∞–≤–æ –∏ –∏–∑–º–µ–Ω–µ–Ω–∏–µ–º —Å—Ç–∞—Ä—à–µ–≥–æ –±–∏—Ç–∞
    # –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–∏ —Å —Ñ—É–Ω–∫—Ü–∏–µ–π –æ–±—Ä–∞—Ç–Ω–æ–π —Å–≤—è–∑–∏
    def pop(self):    
        #self.debug()
        state = self.s
        self.s = (
            # —Ñ–æ—Ä–º—Ä–æ–≤–∞–Ω–∏–µ —Å—Ç–∞—Ä—à–µ–≥–æ –±–∏—Ç–∞
            ((self.f(state) & 1) << (self.l-1))  
            ^
            # —Å–¥–≤–∏–≥ –≤–ø—Ä–∞–≤–æ
            ((state >> 1) & ((1 << (self.l-1))-1)) 
        )
        # –º–ª–∞–¥—à–∏–π –±–∏—Ç
        return state & 1 
    
    def debug(self):
        print(f"\tR[{self.l}]: {bin(self.s)[2:].rjust(self.l, '0')}")
```

–ó–∞–¥–∞–¥–∏–º —Ä–µ–≥–∏—Å—Ç—Ä—ã –±–∏—Ç–∞–º–∏, –∫–æ—Ç–æ—Ä—ã–µ —Ñ–æ—Ä–º–∏—Ä—É—é—Ç –æ–±—Ä–∞—Ç–Ω—É—é —Å–≤—è–∑—å:


```python
F1=0x1155105
F2=0x101000001
```

–¢–∞–∫–æ–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ —ç–∫–≤–∏–≤–∞–ª–µ–Ω—Ç–Ω–æ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—é –º–Ω–æ–≥–æ—á–ª–µ–Ω–∞–º–∏:


```python
from sympy import Poly, gcd, symbols, parse_expr
```


```python
x = symbols('x')
```


```python
F1x = Poly(map(int, list(bin( F1 )[2:])), x, modulus=2)
F2x = Poly(map(int, list(bin( F2 )[2:])), x, modulus=2)
```


```python
F1x
```


$\displaystyle \operatorname{Poly}{\left( x^{24} + x^{20} + x^{18} + x^{16} + x^{14} + x^{12} + x^{8} + x^{2} + 1, x, domain=\mathbb{F}_{2} \right)}$


```python
F2x
```


$\displaystyle \operatorname{Poly}{\left( x^{32} + x^{24} + 1, x, domain=\mathbb{F}_{2} \right)}$



### 1.3. –§—É–Ω–∫—Ü–∏–∏ —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è –∏ —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è

–í —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–∏ —Å–æ —Å—Ö–µ–º–æ–π, –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ –∫–∞–∂–¥–æ–≥–æ –±–∞–π—Ç–∞ $x\in X$ —Ä–µ–∞–ª–∏–∑—É–µ—Ç—Å—è:
1. –≤—ã—á–∏—Å–ª–µ–Ω–∏–µ 10 –∑–Ω–∞–∫–æ–≤ –≥–∞–º–º—ã $\gamma_1,...,\gamma_{10}$ –∫–∞–∫ $R1 \oplus R2$
2. 10 —Ç–∞–∫—Ç–∞–º–∏ —Ñ—É–Ω–∫—Ü–∏–∏ $g$ –Ω–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏—Ö –∑–Ω–∞–∫–∞—Ö –≥–∞–º–º—ã, —Å–ª–µ–¥—É—é—â–∏—Ö –≤ –ø—Ä—è–º–æ–º –ø–æ—Ä—è–¥–∫–µ - $\gamma_1,...,\gamma_{10}$

–û–ø—Ä–µ–¥–µ–ª–∏–º —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ –æ–±—Ä–∞—Ç–Ω–æ–π —Å–≤—è–∑–∏ —Ä–µ–≥–∏—Å—Ç—Ä–æ–≤


```python
def f1(s):
    return bin(s & F1 & 0xFFFFFF).count('1') % 2

def f2(s):
    return bin(s & F2 & 0xFFFFFFFF).count('1') % 2
```


```python
def encryption(X, key1, key2):
    R24 = R(stateLen=24, feedBack=f1, initState=key1)
    R32 = R(stateLen=32, feedBack=f2, initState=key2)
    Y = b''
    for x in X: 
        y = x
        gammas = [R24.pop() ^ R32.pop() for _ in range(10)]
        for gamma in gammas:
            y = g(gamma, y)
        Y += bytes([y])
    return Y
```

–†–∞—Å—à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ –∫–∞–∂–¥–æ–≥–æ –±–∞–π—Ç–∞ $y\in Y$ —Ä–µ–∞–ª–∏–∑—É–µ—Ç—Å—è:
1. –≤—ã—á–∏—Å–ª–µ–Ω–∏–µ 10 –∑–Ω–∞–∫–æ–≤ –≥–∞–º–º—ã $\gamma_1,...,\gamma_{10}$ –∫–∞–∫ $R1 \oplus R2$
2. 10 —Ç–∞–∫—Ç–∞–º–∏ —Ñ—É–Ω–∫—Ü–∏–∏ $g^{-1}$ –Ω–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏—Ö –∑–Ω–∞–∫–∞—Ö –≥–∞–º–º—ã, —Å–ª–µ–¥—É—é—â–∏—Ö –≤ –æ–±—Ä–∞—Ç–Ω–æ–º –ø–æ—Ä—è–¥–∫–µ - $\gamma_{10},...,\gamma_1$


```python
def decipher(Y, key1, key2):
    R24 = R(stateLen=24, feedBack=f1, initState=key1)
    R32 = R(stateLen=32, feedBack=f2, initState=key2)
    X = b''
    for y in Y:
        x = y
        gammas = [R24.pop() ^ R32.pop() for _ in range(10)]
        for gamma in gammas[::-1]: # –æ–±—Ä–∞—Ç–Ω—ã–π –ø–æ—Ä—è–¥–æ–∫ –≥–∞–º–º
            x = inv_g(gamma, x)
        X += bytes([x])
    return X
```



### 1.4. –ü—Ä–∏–º–µ—Ä—ã —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è —Å–æ–æ–±—â–µ–Ω–∏—è

–ü–æ–ø—Ä–æ–±—É–µ–º –∑–∞—à–∏—Ñ—Ä–æ–≤–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ: "–ö—Ä–∏–ø—Ç–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏–µ –º–µ—Ç–æ–¥—ã –∑–∞—â–∏—Ç—ã –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏"

–í –ø–µ—Ä–≤—É—é –æ—á–µ—Ä–µ–¥—å, —Å–≥–µ–Ω–µ—Ä–∏—Ä—É–µ–º –∫–ª—é—á–∏:


```python
import random

k1 = random.randint(0, 1 << 24)
k2 = random.randint(0, 1 << 32)

print(f"k1: {bin(k1)[2:]}")
print(f"k2: {bin(k2)[2:]}")
```

    k1: 101000000111011011111011
    k2: 111100001001011101110011000011

```python
message = "–ö—Ä–∏–ø—Ç–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏–µ –º–µ—Ç–æ–¥—ã –∑–∞—â–∏—Ç—ã –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏"
bMessage = bytes(message, encoding="utf-8")
```

–í—ã—á–∏—Å–ª–∏–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è:


```python
cip = encryption(bMessage, k1, k2)
print(cip)
```

    b'\xbe|\x96\x0e\x9cy\x9aN\xce\x0cp \xbe>\x96\x0e\x9c;\xda@\x16\x820\xa6\xbe\xae\x96\xc6\x9c\xd8\x9a\xce\x16\xc1L?`\xea\x83\xd6\x08\xc6\xcdu\n\xd8\xbe\xc7\xbe\xff^\x03\xd4\x0c\x9a\xce\xce\x0c0\xa5\x86\xea\xc0\x1e\x86\x1e\x8buX\xd8d?`\xea\xc2\xd6\t\xc6\x84u\t'


–†–∞—Å—à–∏—Ñ—Ä—É–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ:


```python
p = decipher(cip, k1, k2)
print(p.decode('utf-8'))
```

    –ö—Ä–∏–ø—Ç–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏–µ –º–µ—Ç–æ–¥—ã –∑–∞—â–∏—Ç—ã –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏



## 2. –ü—Ä–æ–±—É–µ–º –≤—ã—Å–∫—Ä—ã—Ç—å —à–∏—Ñ—Ä 

–ë—É–¥–µ–º —Ä–∞—Å—Å–º–∞—Ç—Ä–∏–≤–∞—Ç—å –∫–∞–∂–¥—É—é –ø–∞—Ä—É –±–∞–π—Ç–æ–≤ –æ—Ç–∫—Ä—ã—Ç–æ–≥–æ –∏ —à–∏—Ñ—Ä—Ç–µ–∫—Å—Ç–∞.



### 2.1. –°–æ–æ–±—â–µ–Ω–∏–µ –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞

–ü—É—Å—Ç—å –∏–º–µ—é—Ç—Å—è –ø–∞—Ä—ã –æ.—Ç./—à.—Ç. —Ç–µ–∫—Å—Ç–æ–≤, –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω—ã—Ö –Ω–∞ –æ–¥–Ω–æ–º –∫–ª—é—á–µ. –°–≥–µ–Ω–µ—Ä–∏—Ä—É–µ–º –∫–ª—é—á–∏ –∏ —Å—Ñ–æ—Ä–º–∏—Ä—É–µ–º —Ç–∞–∫–∏–µ –ø–∞—Ä—ã:


```python
k1 = random.randint(0, 1 << 24)
k2 = random.randint(0, 1 << 32)

print(f"k1: {hex(k1)[2:]}")
print(f"k2: {hex(k2)[2:]}")
```

    k1: 6465a
    k2: 0x79826546

```python
bMessage = b'Meet me on Monday at 5pm'
```


```python
cip = encryption(bMessage, k1, k2)
print(cip)
```

    b'\x94\x19}\xb3HPwxL\xd2\xc2~\x0c\xbb=w\x8d\x03\xb4l\x8f\x04Vv'



### 2.2. –ù–∞—Ö–æ–∂–¥–µ–Ω–∏–µ —ç–∫–≤–∏–≤–∞–ª–µ–Ω—Ç–Ω–æ–≥–æ —Ä–µ–≥–∏—Å—Ç—Ä–∞

–î–ª—è —É–¥–æ–±—Å—Ç–≤–∞ –∞–Ω–∞–ª–∏–∑–∞, –º—ã –ø—Ä–µ–¥—Å—Ç–∞–≤–∏–º –¥–≤–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞ –æ–¥–Ω–∏–º.
–î–ª—è —ç—Ç–æ–≥–æ –≤—ã—á–∏—Å–ª–∏–º –ù–û–ö –∏—Ö –º–Ω–æ–≥–æ—á–ª–µ–Ω–æ–≤:


```python
LCMx = ( (F1x * F2x) // gcd(F1x, F2x) ).as_poly()
LCMx
```


$\displaystyle \operatorname{Poly}{\left( x^{40} + x^{34} + x^{26} + x^{24} + x^{8} + x^{2} + 1, x, domain=\mathbb{F}_{2} \right)}$

–ò –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏—Ö –±–∏–Ω–∞—Ä–Ω–æ–π –∏ —à–µ—Å–Ω–∞–¥—Ü–∞—Ç–∏—Ä–∏—á–Ω–æ–π –∑–∞–ø–∏—Å—è—Ö: 


```python
LCM = int(''.join(map(str, LCMx.as_list())), base=2)
print(f"hex: {hex(LCM)[2:]}")
print(f"bin: {bin(LCM)[2:]}")
```

    hex: 10405000105
    bin: 10000010000000101000000000000000100000101


–ó–∞–º–µ—Ç–∏–º, —á—Ç–æ –ø–æ—Å–∫–æ–ª—å–∫—É –Ω–∞ –∫–∞–∂–¥–æ–º —Å–∏–º–≤–æ–ª–µ –æ—Ç–∫—Ä—ã—Ç–æ–≥–æ —Ç–µ–∫—Å—Ç–∞ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç 10 —Ç–∞–∫—Ç–æ–≤, –¥–ª—è —Ö–≤–∞—Ç–∏—Ç $k$ –ø–∞—Ä –æ.—Ç./—à.—Ç., –≥–¥–µ $10k\ge deg(–ù–û–ö(F_1, F_2))$

–í –Ω–∞—à–µ–º —Å–ª—É—á–∞–µ, —Ö–≤–∞—Ç–∏—Ç 4-–µ—Ö –ø–∞—Ä


```python
k = 4
```



### 2.3. –í—ã—á–∏—Å–ª–µ–Ω–∏–µ –≤—Å–µ–≤–æ–∑–º–æ–∂–Ω—ã—Ö –ø–æ–¥—Å—Ç–∞–Ω–æ–≤–æ–∫ —É–ø—Ä–∞–≤–ª—è—é—â–µ–π –∫–æ–º–±–∏–Ω–∞—Ü–∏–∏  

–ù–∞–π–¥–µ–º –¥–ª—è –∫–∞–∂–¥–æ–π –∏–∑ 4-—Ö –ø–∞—Ä –ø–æ–¥—Å—Ç–∞–Ω–æ–≤–∫–∏, –∫–æ—Ç–æ—Ä—ã–µ –ø–µ—Ä–µ–≤–æ–¥—è—Ç —Å–∏–º–≤–æ–ª –æ—Ç–∫—Ä—ã—Ç–æ–≥–æ —Ç–µ–∫—Å—Ç–∞ –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ —Å–∏–º–≤–æ–ª —à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–∞

–ó–∞–º–µ—Ç–∏–º, —á—Ç–æ, –ø–æ–¥—Å—Ç–∞–Ω–æ–≤–æ–∫, —Ä–µ–∞–ª–∏–∑—É–µ–º—ã—Ö 10 —Ç–∞–∫—Ç–∞–º–∏ - —Ä–æ–≤–Ω–æ $2^{10}=1024$, –∫–∞–∂–¥–∞—è –∏–∑ –∫–æ—Ç–æ—Ä—ã—Ö –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è –±–∏—Ç–æ–º –∫–ª—é—á–µ–≤–æ–≥–æ –ø–æ—Ç–æ–∫–∞.
–ü—Ä–∏—á–µ–º –∫–∞–∂–¥–∞—è –ø–æ–¥—Å—Ç–∞–Ω–æ–≤–∫–∞ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å—é –∏–∑ $2^8$ –±–∏—Ç

–¢—Ä—É–¥–æ–∑–∞—Ç—Ä–∞—Ç—ã –Ω–∞ –≤—ã—á–∏—Å–ª–µ–Ω–∏–µ –≤—Å–µ—Ö –ø–æ–¥—Å—Ç–∞–Ω–æ–≤–æ–∫ –Ω–µ–±–æ–ª—å—à–∏–µ. –í—ã—á–∏—Å–ª–∏–º –∏—Ö:


```python
# gammas - 10 –±–∏—Ç–Ω–æ–µ —á–∏—Å–ª–æ
# i-—ã–π –±–∏—Ç —Å–æ–æ—Ç–≤–µ—Å—Ç–≤—É–µ—Ç –∑–Ω–∞–∫—É i-–æ–º—É –∑–Ω–∞–∫—É –≥–∞–º–º—ã
# gammas = 1111000011 —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –ø–æ–¥—Å—Ç–∞–Ω–æ–≤–∫–µ G:
# G = g[1]g[1]g[0]g[0]g[1]g[1]...g[1],
# –≥–¥–µ g[k] = —Ñ—É–Ω–∫—Ü–∏—è –æ–¥–Ω–æ–≥–æ —Ç–∞–∫—Ç–∞ —Å–æ –∑–Ω–∞–∫–æ–º –≥–∞–º–º—ã k 
S = {
    gammas: [   
        g( (gammas>>9) &1,
        g( (gammas>>8) &1,
        g( (gammas>>7) &1,
        g( (gammas>>6) &1,
        g( (gammas>>5) &1,
        g( (gammas>>4) &1,
        g( (gammas>>3) &1,
        g( (gammas>>2) &1,
        g( (gammas>>1) &1,
        g( (gammas>>0) &1, x )))))))))) 
        for x in range(1<<8)
    ] 
    for gammas in range(1<<10)
}
```

–ö–∞–∂–æ–µ $B_i$ —Å–æ—Å—Ç–æ–∏—Ç –∏–∑ –∑–Ω–∞—á–µ–Ω–∏–π –æ—Ç—Ä–µ–∑–∫–∞ –≥–∞–º–º—ã ($10$ –∑–Ω–∞–∫–æ–≤), –∫–æ—Ç–æ—Ä—ã–µ –º–æ–∂–µ—Ç –ø–æ—Ä–æ–∂–¥–∞—Ç—å –∫–ª—é—á–µ–≤–æ–π –ø–æ—Ç–æ–∫ –Ω–∞ $i$-–æ–π –±—É–∫–≤–µ


```python
possibleGammas = {}

for i in range(k):
    possibleGammas[i] = []
    for gammas, G in S.items():
        if G[ bMessage[ i ] ] == cip[ i ]:
            possibleGammas[i].append(gammas)  

print(possibleGammas)
```

    {0: [31, 286, 541, 796], 1: [9, 264, 651, 970], 2: [152, 409, 602, 795], 3: [55, 310, 689, 944]}


–ü—Ä–æ–∏–Ω—Ç–µ—Ä–ø—Ä–∏—Ç–∏—Ä—É–µ–º –ø–æ–ª—É—á–µ–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç. –ü–µ—Ä–≤—ã–π –±–∞–π—Ç –æ—Ç–∫—Ä—ã—Ç–æ–≥–æ —Ç–µ–∫—Å—Ç–∞ –º–æ–∂–µ—Ç –ø–µ—Ä–µ–π—Ç–∏ –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π –±–∞–π—Ç —à–∏—Ñ—Ä—Ç–µ–∫—Å—Ç–∞ 4-–º—è –≤–∞—Ä–∏–∞–Ω—Ç–∞–º–∏ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –∫–ª—é—á–µ–≤–æ–≥–æ –ø–æ—Ç–æ–∫–∞.



### 2.4. –û–ø—Ä–µ–¥–µ–ª—è–µ–º —ç–∫–≤–∏–≤–∞–ª–µ–Ω—Ç–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è –∏ —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è

–û–ø—Ä–µ–¥–µ–ª–∏–º —Ñ—É–Ω–∫—Ü—é –æ–±—Ä–∞—Ç–Ω–æ–π —Å–≤—è–∑–∏ —ç–∫–≤–∏–≤–∞–ª–µ–Ω—Ç–Ω–æ–≥–æ —Ä–µ–≥–∏—Å—Ç—Ä —Å–¥–∏–≤–≥–∞, –∞ —Ç–∞–∫–∂–µ —ç–∫–≤–∏–≤–∞–ª–µ–Ω—Ç–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ —à–∏—Ä–æ–≤–∞–Ω–∏—è –∏ —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è —á–µ—Ä–µ–∑ —Ä–µ–≥–∏—Å—Ç—Ä $R_{40}$. –ò—Å–ø–æ–ª—å–∑—É–µ–º –¥–ª—è —ç—Ç–æ–≥–æ –Ω–∞–π–¥–µ–Ω–Ω—ã–π –ù–û–ö –º–Ω–æ–≥–æ—á–ª–µ–Ω–æ–≤ –≤ –ø—É–Ω–∫—Ç–µ 2.2


```python
def lcmF(s):
    return bin(s & LCM & 0xFFFFFFFFFF).count('1') % 2
```


```python
def eq_encryption(Y, key):
    R40 = R(stateLen=40, feedBack=lcmF, initState=key)
    X = b''
    for y in Y:
        x = y
        gammas = [R40.pop() for _ in range(10)]
        for gamma in gammas:
            x = g(gamma, x)
        X += bytes([x])
    return X
```


```python
def eq_decipher(Y, key):
    R40 = R(stateLen=40, feedBack=lcmF, initState=key)
    X = b''
    for y in Y:
        x = y
        gammas = [R40.pop() for _ in range(10)]
        for gamma in gammas[::-1]:
            x = inv_g(gamma, x)
        X += bytes([x])
    return X
```

–ü—Ä–æ–≤–µ—Ä–∏–º, —á—Ç–æ —Ñ—É–Ω–∫—Ü–∏–∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã. –î–ª—è —ç—Ç–æ–≥–æ –ø–æ–ø—Ä–æ–±—É–µ–º –∑–∞—à–∏—Ñ—Ä–æ–≤–∞—Ç—å –∏ —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ:


```python
key = random.randint(0, 1<<40)
eq_decipher(eq_encryption(b'Secure message!', key), key)
```


    b'Secure message!'

–ï—Å–ª–∏ –ø–æ—Å–º–æ—Ç—Ä–∏–º –Ω–∞ –ø–µ—Ä–≤—ã–µ 40 –∑–Ω–∞–∫–æ–≤ –≥–∞–º–º—ã, –∫–æ—Ç–æ—Ä—ã–µ –ø–æ—Ä–æ–∂–¥–∞—é—Ç—Å—è —Ä–µ–≥–∏—Å—Ç—Ä–∞–º–∏ $R_{24}$ –∏ $R_{32}$, –∞ —Ç–∞–∫–∂–µ –Ω–∞ –∑–Ω–∞–∫–∏ –≥–∞–º–º—ã —Ä–µ–≥–∏—Å—Ç—Ä–∞ $R_{40}$, —Ç–æ –∑–∞–º–µ—Ç–∏–º, —á—Ç–æ –æ–Ω–∏ –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ —ç–∫–≤–∏–≤–∞–ª–µ–Ω—Ç–Ω—ã:


```python
R24 = R(stateLen=24, feedBack=f1, initState=k1)
R32 = R(stateLen=32, feedBack=f2, initState=k2)
R24_R32_gammas_40 = ''.join(map(str, [R24.pop() ^ R32.pop() for _ in range(40)]))[::-1]

R40 = R(stateLen=40, feedBack=lcmF, initState=int(R24_R32_gammas_40, base=2))
R40_gammas_40 = ''.join(map(str, [R40.pop() for _ in range(40)]))[::-1]

print(f'R24^R32: {R24_R32_gammas_40}')
print(f'    R40: {R40_gammas_40}')
```

    R24^R32: 0100110110001001100001000010001100011100
        R40: 0100110110001001100001000010001100011100


–ó–¥–µ—Å—å –ø–µ—Ä–≤—ã–π –∑–Ω–∞–∫ –≥–∞–º–º—ã —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –ø—Ä–∞–≤–æ–º—É (–º–ª–∞–¥—à–µ–º—É) –±–∏—Ç—É - —Ç–∞–∫–∂–µ, –∫–∞–∫ –æ–Ω–∏ –ª–µ–∂–∞—Ç –≤ —Ä–µ–≥–∏—Å—Ç—Ä–µ –Ω–∞ —Å—Ö–µ–º–µ

–ò –≤–æ–æ–±—â–µ, –ª—é–±–æ–π –æ—Ç—Ä–µ–∑–æ–∫:


```python
Len = 100000

R24 = R(stateLen=24, feedBack=f1, initState=k1)
R32 = R(stateLen=32, feedBack=f2, initState=k2)


R24_R32_gammas = ''.join(map(str, [R24.pop() ^ R32.pop() for _ in range(Len)]))[::-1]

R40 = R(stateLen=40, feedBack=lcmF, initState=int(R24_R32_gammas_40, base=2))

R40_gammas = ''.join(map(str, [R40.pop() for _ in range(Len)]))[::-1]

print(R24_R32_gammas == R40_gammas)
```

    True



### 2.5. –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –æ—Ç—Ä–µ–∑–∫–∞ –≥–∞–º–º—ã


```python
possibleGammas
```


    {0: [31, 286, 541, 796],
     1: [9, 264, 651, 970],
     2: [152, 409, 602, 795],
     3: [55, 310, 689, 944]}

–ü–æ—Å–∫–æ–ª—å–∫—É —ç–∫–≤–∏–≤–∞–ª–µ–Ω—Ç–Ω—ã–π —Ä–µ–≥–∏—Å—Ç—Ä —Å–¥–≤–∏–≥–∞ –¥–ª–∏–Ω–æ–π $40$ –±–∏—Ç, —Ç–æ –æ–¥–∏–Ω –∏–∑ $4^4$ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ –∫–ª—é—á–µ–≤–æ–≥–æ –ø–æ—Ç–æ–∫–∞ —è–≤–ª—è–µ—Ç—Å—è –Ω–∞—á–∞–ª—å–Ω—ã–º –∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ–º —Ä–µ–≥–∏—Å—Ç—Ä–∞. –í–∞—Ä–∏–∞–Ω—Ç–æ–≤ –Ω–µ –º–Ω–æ–≥–æ, –∞ –∑–Ω–∞—á–∏—Ç –º–æ–∂–Ω–æ –ø—Ä–æ—Å—Ç–æ –ø–µ—Ä–µ–±—Ä–∞—Ç—å.


```python
i = 1
for gamma_4 in possibleGammas[3]:
    for gamma_3 in possibleGammas[2]:
        for gamma_2 in possibleGammas[1]:
            for gamma_1 in possibleGammas[0]:
                key = int(
                      bin( gamma_4 )[2:].rjust(10, '0')
                    + bin( gamma_3 )[2:].rjust(10, '0')
                    + bin( gamma_2 )[2:].rjust(10, '0')
                    + bin( gamma_1 )[2:].rjust(10, '0'),
                    base=2
                )
                try:
                    print("{:3d}. eq_decipher( cip, '{}' ) = '{}'". format(
                        i,
                        hex(key)[2:],
                        eq_decipher(cip, key).decode('utf-8') # –∫—Ä–∏—Ç–µ—Ä–∏–π –Ω–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ —Å–∏–º–≤–æ–ª—ã —é–Ω–∏–∫–æ–¥–∞
                    ))
                    i+=1
                except:
                    continue
```

      1. eq_decipher( cip, 'dc980261d' ) = 'Meet%h-!jk`/&da6%!u%00,'
      2. eq_decipher( cip, 'dc980271c' ) = 'Meetde5+x ^o&da70aal%p~'
      3. eq_decipher( cip, 'dc984221d' ) = 'Meet!h-5nk`/nda2%!a!00<'
      4. eq_decipher( cip, 'dc984231c' ) = 'Meet`e!/z Londa30auh%pl'
      5. eq_decipher( cip, 'dd990261d' ) = 'Meet0}ap;z$Y/&dao0e$0%ty'
      6. eq_decipher( cip, 'dd990271c' ) = 'Meetqh)dzkd	o&dan%%0{04)'
      7. eq_decipher( cip, 'dd994221d' ) = 'Meet4}ad?x$I/ndak0e04%ti'
      8. eq_decipher( cip, 'dd994231c' ) = 'Meetuh)p~kdondaj%%$04;'
      9. eq_decipher( cip, '4d8980261d' ) = 'Meetex- *`\r/&da~5!tm 0-'
     10. eq_decipher( cip, '4d8980271c' ) = 'Meet$me4kn ]o&da} a`$5p}'
     11. eq_decipher( cip, '4d8984221d' ) = 'Meetax-4.}`/ndaz5!`i 0?'
     12. eq_decipher( cip, '4d8984231c' ) = 'Meet me on Monday at 5pm'
     13. eq_decipher( cip, '4d9990261d' ) = 'Meetpmaq{n$Z/&da' e%z5tz'
     14. eq_decipher( cip, '4d9990271c' ) = 'Meet1z)e:}o&da&5%11 4('
     15. eq_decipher( cip, '4d9994221d' ) = 'Meettmaen$H/nda# e1~5th'
     16. eq_decipher( cip, '4d9994231c' ) = 'Meet5z)q>donda"5%%5 48'


**–¢–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º –º—ã —Å–æ–∫—Ä–∞—Ç–∏–ª–∏ –ø–µ—Ä–µ–±–æ—Ä –∫–ª—é—á–∞ —Å $2^{40}$ –¥–æ $2^8$ !**
